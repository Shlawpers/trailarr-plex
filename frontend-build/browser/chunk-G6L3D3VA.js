import{b as d,c as m,d as o,e as x,f as U,g as I,h as L,j as O}from"./chunk-6UGYNOAF.js";import{Aa as l,Ac as f,Dc as M,Fc as A,Gc as D,Z as E,a as T,b as w,bc as S,c as $,da as F,p,v as C}from"./chunk-4G6SW77C.js";function j(s){let r=Math.floor(s/60),t=Math.floor(s%60);return r===0?`${t}m`:t===0?`${r}h`:`${r}h ${t}m`}function B(s){let r=Date.now();if(s<r||(s-=r,s<0))return"0 seconds";let t=Math.floor(s/36e5),e=Math.floor(s%36e5/6e4),i=Math.floor(s%6e4/1e3);return t===0&&e===0&&i===0?"0 seconds":t===0&&e===0?`${i} seconds`:t===0?`${e} minutes ${i} seconds`:`${t} hours ${e} minutes ${i} seconds`}var J=(s,r)=>s===r||JSON.stringify(s)===JSON.stringify(r),g=new Map;function h(s=0){return function(r,t,e){let i=e.value;e.value=function(...n){let a=`${t.toString()}:${JSON.stringify(n)}`;if(g.has(a)){let _=g.get(a);if(s>0&&Date.now()-_.timestamp>s)g.delete(a);else return _.value}let y=i.apply(this,n);return g.set(a,{value:y,timestamp:Date.now()}),y}}}var u=class{static parseDate(r){return new Date(r)}static parseNumber(r){return parseFloat(r)}static getDaysAgo(r){let t=new Date;return t.setDate(t.getDate()-r),t}};p([h()],u,"parseDate",null);p([h()],u,"parseNumber",null);p([h()],u,"getDaysAgo",null);var c=class{static applyBooleanFilter(r,t){return r===t}static applyNumberFilter(r,t,e){switch(e){case m.GREATER_THAN:return r>t;case m.GREATER_THAN_EQUAL:return r>=t;case m.LESS_THAN:return r<t;case m.LESS_THAN_EQUAL:return r<=t;case m.EQUALS:return r===t;case m.NOT_EQUALS:return r!==t;default:return!0}}static applyDateFilter(r,t,e,i){switch(e){case d.IS_AFTER:return r>t;case d.IS_BEFORE:return r<t;case d.IN_THE_LAST:return i?r>i:!1;case d.NOT_IN_THE_LAST:return i?r<i:!1;case d.EQUALS:return r.toDateString()===t.toDateString();case d.NOT_EQUALS:return r.toDateString()!==t.toDateString();default:return!0}}static applyStringFilter(r,t,e){switch(e){case o.CONTAINS:return r.includes(t);case o.NOT_CONTAINS:return!r.includes(t);case o.EQUALS:return r===t;case o.NOT_EQUALS:return r!==t;case o.STARTS_WITH:return r.startsWith(t);case o.NOT_STARTS_WITH:return!r.startsWith(t);case o.ENDS_WITH:return r.endsWith(t);case o.NOT_ENDS_WITH:return!r.endsWith(t);case o.IS_EMPTY:return r==="";case o.IS_NOT_EMPTY:return r!=="";default:return!0}}};p([h()],c,"applyBooleanFilter",null);p([h()],c,"applyNumberFilter",null);p([h()],c,"applyDateFilter",null);function Q(s,r){let{filter_by:t,filter_value:e,filter_condition:i}=s,n=r[t];if(x.includes(t)){let a=e.toLowerCase()==="true";return c.applyBooleanFilter(n,a)}if(U.includes(t)){let a=u.parseDate(n),y=u.parseDate(e),_=parseInt(e),v=isNaN(_)?void 0:u.getDaysAgo(_);return c.applyDateFilter(a,y,i,v)}if(I.includes(t)){let a=u.parseNumber(e);return c.applyNumberFilter(n,a,i)}return L.includes(t)?c.applyStringFilter(n,e,i):!0}function W(s,r,t){let e=s.find(i=>i.filter_name===r);return e?e.filters.every(i=>Q(i,t)):!0}function b(s,r,t){return s.filter(e=>{switch(r){case"all":return!0;case"downloaded":return e.trailer_exists;case"downloading":return e.status.toLowerCase()==="downloading";case"missing":return!e.trailer_exists;case"monitored":return e.monitor;case"unmonitored":return!e.monitor&&!e.trailer_exists;case"movies":return e.is_movie&&e.trailer_exists;case"series":return!e.is_movie&&e.trailer_exists;default:return W(t,r,e)}})}function H(s,r,t){s.sort((e,i)=>{let n=e[r],a=i[r];return n instanceof Date&&a instanceof Date?t?n.getTime()-a.getTime():a.getTime()-n.getTime():typeof n=="number"&&typeof a=="number"?t?n-a:a-n:t?e[r].toString().localeCompare(i[r].toString()):i[r].toString().localeCompare(e[r].toString())})}function R(s){return w(T({},s),{added_at:new Date(`${s.added_at}Z`),updated_at:new Date(`${s.updated_at}Z`),downloaded_at:new Date(`${s.downloaded_at}Z`),isImageLoaded:!1})}function N(s){let r=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return s.files&&(r=s.files.map(t=>Z(t)?K(t):N(t))),w(T({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`),files:r})}function K(s){return w(T({},s),{isExpanded:!1,modified:new Date(`${s.created}Z`)})}function Z(s){return s.type==="file"}var lt=(()=>{class s{constructor(){this.httpClient=F(M),this.customfilterService=F(O),this.mediaUrl=D.apiUrl+D.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=A(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:t=>t&&Array.isArray(t)?t.map(R):[]}),this.filteredSortedMedia=S(()=>{let t=b(this.allMedia(),this.selectedFilter(),this.customFilters());return H(t,this.selectedSort(),this.sortAscending()),t}),this.displayMedia=S(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=S(()=>{let t=this.selectedMediaID();return t===null?null:this.mediaResource.value().find(e=>e.id===t)||null}),this.allMedia=S(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(e=>e.is_movie);case!1:return this.mediaResource.value().filter(e=>!e.is_movie);case null:return this.mediaResource.value().filter(e=>e.status.toLowerCase()==="downloaded")}})}searchMedia(t){let e=`${this.mediaUrl}search`,i=new f().set("query",t);return this.httpClient.get(e,{params:i})}batchUpdate(t,e,i=-1){let n=`${this.mediaUrl}batch_update`;return this.httpClient.post(n,{media_ids:t,action:e.toLowerCase(),profile_id:i})}downloadMediaTrailer(t,e,i){let n=new f().set("profile_id",e).set("yt_id",i),a=`${this.mediaUrl}${t}/download`;return this.httpClient.post(a,{},{params:n})}monitorMedia(t,e){let i=new f().set("monitor",e),n=`${this.mediaUrl}${t}/monitor`;return this.httpClient.post(n,{},{params:i})}deleteMediaTrailer(t){let e=`${this.mediaUrl}${t}/trailer`;return this.httpClient.delete(e)}fetchMediaFiles(t){return $(this,null,function*(){let e=`${this.mediaUrl}${t}/files`,i=yield C(this.httpClient.get(e));return N(i)})}searchMediaTrailer(t,e){let i=new f().set("profile_id",e),n=`${this.mediaUrl}${t}/search`;return this.httpClient.post(n,{},{params:i})}saveMediaTrailer(t,e){let i=`${this.mediaUrl}${t}/update`,n=new f().set("yt_id",e);return this.httpClient.post(i,{},{params:n})}static{this.\u0275fac=function(e){return new(e||s)}}static{this.\u0275prov=E({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{j as a,B as b,J as c,lt as d};
