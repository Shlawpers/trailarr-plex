import{o as v}from"./chunk-53SIXYQU.js";import{a as p}from"./chunk-IK2DGUM6.js";import{Ic as n,Jc as f,Y as a,ca as c,dc as h,za as u}from"./chunk-M4QNQTBX.js";var g=(()=>{class o{constructor(){this.profilesUrl=f.apiUrl+f.trailerprofiles,this._service=c(v),this.websocketService=c(p),this.allProfiles=n(this.profilesUrl,{defaultValue:[]}),this.selectedProfileId=u(0),this.fetchSelectedProfileResource=n(()=>{if(!(this.selectedProfileId()<=0||this.allProfiles.value().findIndex(e=>e.id===this.selectedProfileId())!==-1))return this.profilesUrl+this.selectedProfileId()}),this.selectedProfile=h(()=>{let r=this.selectedProfileId();if(r<=0)return;let e=this.allProfiles.value().find(t=>t.id===r);return e||this.fetchSelectedProfileResource.value()})}updateSetting(r,e){let t=this.selectedProfileId();if(t<=0)throw new Error("No profile selected");this._service.updateTrailerProfileSettingApiV1TrailerprofilesTrailerprofileIdSettingPost({trailerprofile_id:t,body:{key:r,value:e}}).subscribe({next:i=>{this.allProfiles.update(l=>{let d=l.findIndex(P=>P.id===i.id);return d!==-1?(l[d]=i,[...l]):[...l,i]});let s=r.charAt(0).toUpperCase()+r.replaceAll("_"," ").slice(1);this.websocketService.showToast(`${s} set to '${e}' successfully!`,"success")},error:i=>{let s="An unknown error occurred!";i.error instanceof ErrorEvent?s=`Error: ${i.error.message}`:s=`Error: ${i.status} ${i.error.detail}`,console.error("Failed to update profile setting:",s),this.websocketService.showToast(s,"error")}})}deleteProfile(r){if(r<=0)throw new Error("Invalid profile ID");this._service.deleteTrailerProfileApiV1TrailerprofilesTrailerprofileIdDelete({trailerprofile_id:r}).subscribe({next:()=>{this.selectedProfileId.set(0),this.allProfiles.reload(),this.websocketService.showToast("Profile deleted successfully!","success")},error:e=>{let t="An unknown error occurred!";e.error instanceof ErrorEvent?t=`Error: ${e.error.message}`:t=`Error: ${e.status} ${e.error.detail}`,console.error("Failed to delete profile:",t),this.websocketService.showToast(t,"error")}})}static{this.\u0275fac=function(e){return new(e||o)}}static{this.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();export{g as a};
