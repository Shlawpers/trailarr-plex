import{a as I,b as w,c as re,d as le,e as F,f as V,g as E,h as $,i as h,j as ae}from"./chunk-MG7WKRGJ.js";import{A as oe,b as R,c as _,d as Q,e as H,j as Z,k as U,n as z,o as K,p as J,q as W,r as X,s as Y,t as ee,w as te,y as ie,z as ne}from"./chunk-3TT22JLU.js";import{a as se}from"./chunk-W6S5ZR6Y.js";import{Db as q,Eb as G,Gb as d,Ib as T,Ma as s,Ta as L,Xa as B,ab as v,bc as N,cc as j,da as M,gb as C,la as m,lb as x,ma as u,na as D,nb as y,ob as b,pb as S,qb as o,rb as r,sb as c,ua as P,ub as k,vb as g,wb as l,ya as O,yb as p}from"./chunk-4G6SW77C.js";var de=["customFilterDialog"];function ce(i,a){i&1&&c(0,"app-load-indicator",1)}function me(i,a){if(i&1&&(o(0,"option",16),d(1),r()),i&2){let e=a.$implicit,t=l(3);C("value",e),s(),T(" ",t.displayTitle(e)," ")}}function ue(i,a){if(i&1&&(o(0,"option",16),d(1),r()),i&2){let e=a.$implicit,t=l(3);C("value",e),s(),T(" ",t.displayTitle(e)," ")}}function pe(i,a){if(i&1&&c(0,"input",18),i&2){let e=l().$index;p("id","filter_value_",e,"")}}function _e(i,a){if(i&1&&c(0,"input",19),i&2){let e=l().$index;p("id","filter_value_",e,"")}}function fe(i,a){if(i&1&&(c(0,"input",25),o(1,"span"),d(2," days"),r()),i&2){let e=l().$index;p("id","filter_value_",e,"")}}function ge(i,a){if(i&1&&c(0,"input",20),i&2){let e=l().$index;p("id","filter_value_",e,"")}}function Ce(i,a){if(i&1&&(o(0,"select",21)(1,"option",26),d(2,"True"),r(),o(3,"option",27),d(4,"False"),r()()),i&2){let e=l().$index;p("id","filter_value_",e,"")}}function he(i,a){if(i&1){let e=k();o(0,"div",8)(1,"div",4)(2,"select",14),g("change",function(n){let f=m(e).$index,A=l(2);return u(A.onFilterByChange(n,f))}),o(3,"option",15),d(4,"Select Filter By"),r(),b(5,me,2,2,"option",16,y),r()(),o(7,"div",4)(8,"select",17),g("change",function(n){let f=m(e).$index,A=l(2);return u(A.onFilterConditionChange(n,f))}),o(9,"option",15),d(10,"Select Condition"),r(),b(11,ue,2,2,"option",16,y),r()(),o(13,"div",4),v(14,pe,1,2,"input",18)(15,_e,1,2,"input",19)(16,fe,3,2)(17,ge,1,2,"input",20)(18,Ce,5,2,"select",21),r(),o(19,"button",22),g("click",function(){let n=m(e).$index,f=l(2);return u(f.removeFilter(n))}),D(),o(20,"svg",23),c(21,"path",24),r()()()}if(i&2){let e=a.$index,t=l(2);C("formGroupName",e),s(2),p("id","filter_by_",e,""),s(3),S(t.filterKeys),s(3),p("id","filter_condition_",e,""),s(3),S(t.filterConditions[e]),s(3),x(t.filterValueTypes[e]==="string"?14:t.filterValueTypes[e]==="number"?15:t.filterValueTypes[e]==="number_days"?16:t.filterValueTypes[e]==="date"?17:t.filterValueTypes[e]==="boolean"?18:-1)}}function Fe(i,a){if(i&1&&(o(0,"button",12),d(1),r()),i&2){let e=l(2);C("disabled",e.customFilterForm.pristine||e.customFilterForm.invalid||e.submitting),s(),T(" ",e.customFilter()?"Update":"Create"," ")}}function ve(i,a){i&1&&(o(0,"div",13),D(),o(1,"svg",28)(2,"circle",29),c(3,"animate",30),r(),o(4,"circle",31),c(5,"animate",32),r(),o(6,"circle",33),c(7,"animate",34),r()()())}function xe(i,a){if(i&1){let e=k();o(0,"form",3),g("ngSubmit",function(){m(e);let n=l();return u(n.onSubmit())})("click",function(n){return m(e),u(n.stopPropagation())}),o(1,"div",4)(2,"label",5),d(3,"Label"),r(),c(4,"input",6),r(),o(5,"div",7),b(6,he,22,6,"div",8,y),o(8,"button",9),g("click",function(){m(e);let n=l();return u(n.addFilter())}),d(9,"Add Filter"),r()(),o(10,"div",10)(11,"button",11),g("click",function(){m(e);let n=l();return u(n.closeDialog(-1))}),d(12,"Cancel"),r(),v(13,Fe,2,2,"button",12)(14,ve,8,0,"div",13),r()()}if(i&2){let e=l();C("formGroup",e.customFilterForm),s(6),S(e.filters.controls),s(7),x(e.submitting?14:13)}}var De=(()=>{class i{constructor(){this.fb=M(ie),this.filterType=O.required(),this.filterTypeValue=N(()=>{let e=this.filterType().toUpperCase();return e=="MOVIES"?h.MOVIES:e=="SERIES"?h.SERIES:e=="TRAILER"?h.TRAILER:h.HOME}),this.customFilter=O(null),this.dialogClosed=new P,this.isLoading=!0,this.customfilterService=M(ae),this.computedSignal=N(()=>{let e=this.customFilter();return this.initForm(e),!0}),this.boolFilterConditions=Object.values(I),this.dateFilterConditions=Object.values(w),this.numberFilterConditions=Object.values(re),this.stringFilterConditions=Object.values(le),this.filterConditions=[],this.filterValueTypes=[],this.filterKeys=F.concat(V,E,$).sort(),this.viewForOptions=Object.values(h),this.customFilterDialog=L.required("customFilterDialog"),this.submitting=!1,j(()=>{this.initForm(this.customFilter())})}ngAfterViewInit(){this.customFilterDialog().nativeElement.showModal()}closeDialog(e){this.customFilterDialog().nativeElement.close(),this.dialogClosed.emit(e),this.filters.clear(),this.addFilter(),this.customFilterForm.reset()}displayTitle(e){return e.toLowerCase().replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())}initForm(e){let t=this.fb.group({id:[e?e.id:null],filter_type:[e?e.filter_type:this.filterTypeValue(),_.required],filter_name:[e?e.filter_name:"",[_.required,_.maxLength(30)]],filters:this.fb.array([],_.required)});return this.customFilterForm=t,e&&e.filters&&e.filters.length?e.filters.forEach(n=>{this.addFilter(n)}):this.addFilter(),this.isLoading=!1,t}get filters(){return this.customFilterForm.get("filters")}createFilter(e){return this.fb.group({id:[e?e.id:null],filter_by:[e?e.filter_by:"",_.required],filter_condition:[e?e.filter_condition:"",_.required],filter_value:[e?e.filter_value:"",_.required],customfilter_id:[e?e.customfilter_id:null]})}getFilterConditions(e){return F.includes(e)?this.boolFilterConditions:V.includes(e)?this.dateFilterConditions:E.includes(e)?this.numberFilterConditions:$.includes(e)?this.stringFilterConditions:[]}getFilterValueType(e,t){return F.includes(e)?"boolean":V.includes(e)?t===w.IN_THE_LAST||t===w.NOT_IN_THE_LAST?"number_days":"date":E.includes(e)?"number":"string"}addFilter(e){e&&e.filter_by?(this.filterConditions.push(this.getFilterConditions(e.filter_by)),this.filterValueTypes.push(this.getFilterValueType(e.filter_by,e.filter_condition))):(this.filterConditions.push([]),this.filterValueTypes.push("string")),this.filters.push(this.createFilter(e))}removeFilter(e){this.filterConditions.splice(e,1),this.filters.removeAt(e)}onFilterByChange(e,t){let n=this.filters.at(t).get("filter_by")?.value;this.filterConditions[t]=this.getFilterConditions(n),this.filterValueTypes[t]=this.getFilterValueType(n,""),this.filters.at(t).get("filter_condition")?.setValue(""),F.includes(n)&&this.filters.at(t).get("filter_condition")?.setValue(I.EQUALS),this.filters.at(t).get("filter_value")?.reset()}onFilterConditionChange(e,t){let n=this.filters.at(t).get("filter_by")?.value;if(e.target){let f=e.target.value;this.filterValueTypes[t]=this.getFilterValueType(n,f)}this.filters.at(t).get("filter_value")?.reset()}onSubmit(){if(!this.submitting)if(this.submitting=!0,this.customFilterForm.valid){let e=this.customFilterForm.value;e.filters.forEach(t=>{t.filter_value=t.filter_value.toString()}),this.customFilter()?.id?this.customfilterService.update(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1}):this.customfilterService.create(e).subscribe(t=>{this.closeDialog(t.id),this.submitting=!1})}else console.log("Form is invalid"),this.customFilterForm.markAllAsTouched(),this.submitting=!1}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=B({type:i,selectors:[["app-add-filter-dialog"]],viewQuery:function(t,n){t&1&&q(n.customFilterDialog,de,5),t&2&&G()},inputs:{filterType:[1,"filterType"],customFilter:[1,"customFilter"]},outputs:{dialogClosed:"dialogClosed"},decls:4,vars:1,consts:[["customFilterDialog",""],[1,"center"],[3,"formGroup"],[3,"ngSubmit","click","formGroup"],[1,"form-group"],["for","filter_name"],["id","filter_name","type","text","maxlength","30","formControlName","filter_name"],["formArrayName","filters",1,"filters-container"],[1,"filter-group",3,"formGroupName"],["type","button",1,"secondary",3,"click"],[1,"buttons-row"],["type","button",1,"danger",3,"click"],["type","submit",1,"primary",3,"disabled"],["title","Submitting form data"],["formControlName","filter_by",3,"change","id"],["value","","disabled",""],[3,"value"],["formControlName","filter_condition",3,"change","id"],["type","text","formControlName","filter_value",3,"id"],["type","number","formControlName","filter_value",3,"id"],["type","date","formControlName","filter_value",3,"id"],["formControlName","filter_value",3,"id"],["type","button",1,"danger","icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M253-99q-38.21 0-65.11-26.6Q161-152.2 161-190v-552h-58v-91h228v-47h297v47h228v91h-58v552q0 37.18-27.21 64.09Q743.59-99 706-99H253Zm453-643H253v552h453v-552ZM357-268h74v-398h-74v398Zm173 0h75v-398h-75v398ZM253-742v552-552Z"],["type","number","placeholder","days","formControlName","filter_value",3,"id"],["value","true"],["value","false"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 200",1,"icon-loading"],["stroke-width","14","r","15","cx","40","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.4"],["stroke-width","14","r","15","cx","100","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.2"],["stroke-width","14","r","15","cx","160","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","0"]],template:function(t,n){t&1&&(o(0,"dialog",null,0),v(2,ce,1,0,"app-load-indicator",1)(3,xe,15,2,"form",2),r()),t&2&&(s(2),x(n.isLoading?2:3))},dependencies:[ne,Z,Y,ee,R,U,X,Q,H,te,se,oe,z,W,K,J],styles:["[_nghost-%COMP%]{display:contents}.center[_ngcontent-%COMP%]{margin:auto}form[_ngcontent-%COMP%]{padding:1rem;display:block flex;flex-direction:column;gap:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.4rem;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.5rem;box-sizing:border-box}option[_ngcontent-%COMP%]{background-color:var(--color-surface-container-high)}.ng-touched.ng-invalid[_ngcontent-%COMP%]:not(form):not(div){border:2px solid var(--color-danger)}.error[_ngcontent-%COMP%]{color:var(--color-danger);font-size:.9rem;margin-top:.4rem}.filters-container[_ngcontent-%COMP%]{border-top:1px solid var(--color-outline);padding-top:1rem}.filter-group[_ngcontent-%COMP%]{display:block flex;flex-wrap:wrap;gap:1rem;align-items:center;border:1px solid var(--color-outline);border-radius:.5rem;padding:.5rem;margin-bottom:.75rem;background-color:var(--color-surface-container-high)}.filter-group[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:nth-child(3){flex:1;text-align:start}.danger[_ngcontent-%COMP%]{width:auto;height:auto}.danger[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger-text)}.buttons-row[_ngcontent-%COMP%]{display:block flex;align-items:center;justify-content:space-around}.icon-loading[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;fill:var(--color-on-surface)}"]})}}return i})();export{De as a};
