import{b as d,c as m,d as o,e as x,f as U,g as I,h as L,j as O}from"./chunk-R5YLZXBD.js";import{Z as E,_b as S,a as T,b as w,c as $,ca as F,nc as _,p,qc as M,ra as l,sc as A,tc as D,v as C}from"./chunk-RBBTGEQZ.js";function j(i){let t=Math.floor(i/60),r=Math.floor(i%60);return t===0?`${r}m`:r===0?`${t}h`:`${t}h ${r}m`}function B(i){let t=Date.now();if(i<t||(i-=t,i<0))return"0 seconds";let r=Math.floor(i/36e5),e=Math.floor(i%36e5/6e4),s=Math.floor(i%6e4/1e3);return r===0&&e===0&&s===0?"0 seconds":r===0&&e===0?`${s} seconds`:r===0?`${e} minutes ${s} seconds`:`${r} hours ${e} minutes ${s} seconds`}var J=(i,t)=>i===t||JSON.stringify(i)===JSON.stringify(t),g=new Map;function h(i=0){return function(t,r,e){let s=e.value;e.value=function(...n){let a=`${r.toString()}:${JSON.stringify(n)}`;if(g.has(a)){let y=g.get(a);if(i>0&&Date.now()-y.timestamp>i)g.delete(a);else return y.value}let f=s.apply(this,n);return g.set(a,{value:f,timestamp:Date.now()}),f}}}var u=class{static parseDate(t){return new Date(t)}static parseNumber(t){return parseFloat(t)}static getDaysAgo(t){let r=new Date;return r.setDate(r.getDate()-t),r}};p([h()],u,"parseDate",null);p([h()],u,"parseNumber",null);p([h()],u,"getDaysAgo",null);var c=class{static applyBooleanFilter(t,r){return t===r}static applyNumberFilter(t,r,e){switch(e){case m.GREATER_THAN:return t>r;case m.GREATER_THAN_EQUAL:return t>=r;case m.LESS_THAN:return t<r;case m.LESS_THAN_EQUAL:return t<=r;case m.EQUALS:return t===r;case m.NOT_EQUALS:return t!==r;default:return!0}}static applyDateFilter(t,r,e,s){switch(e){case d.IS_AFTER:return t>r;case d.IS_BEFORE:return t<r;case d.IN_THE_LAST:return s?t>s:!1;case d.NOT_IN_THE_LAST:return s?t<s:!1;case d.EQUALS:return t.toDateString()===r.toDateString();case d.NOT_EQUALS:return t.toDateString()!==r.toDateString();default:return!0}}static applyStringFilter(t,r,e){switch(e){case o.CONTAINS:return t.includes(r);case o.NOT_CONTAINS:return!t.includes(r);case o.EQUALS:return t===r;case o.NOT_EQUALS:return t!==r;case o.STARTS_WITH:return t.startsWith(r);case o.NOT_STARTS_WITH:return!t.startsWith(r);case o.ENDS_WITH:return t.endsWith(r);case o.NOT_ENDS_WITH:return!t.endsWith(r);case o.IS_EMPTY:return t==="";case o.IS_NOT_EMPTY:return t!=="";default:return!0}}};p([h()],c,"applyBooleanFilter",null);p([h()],c,"applyNumberFilter",null);p([h()],c,"applyDateFilter",null);function Q(i,t){let{filter_by:r,filter_value:e,filter_condition:s}=i,n=t[r];if(x.includes(r)){let a=e.toLowerCase()==="true";return c.applyBooleanFilter(n,a)}if(U.includes(r)){let a=u.parseDate(n),f=u.parseDate(e),y=parseInt(e),v=isNaN(y)?void 0:u.getDaysAgo(y);return c.applyDateFilter(a,f,s,v)}if(I.includes(r)){let a=u.parseNumber(e);return c.applyNumberFilter(n,a,s)}return L.includes(r)?c.applyStringFilter(n,e,s):!0}function W(i,t,r){let e=i.find(s=>s.filter_name===t);return e?e.filters.every(s=>Q(s,r)):!0}function b(i,t,r){return i.filter(e=>{switch(t){case"all":return!0;case"downloaded":return e.trailer_exists;case"downloading":return e.status.toLowerCase()==="downloading";case"missing":return!e.trailer_exists;case"monitored":return e.monitor;case"unmonitored":return!e.monitor&&!e.trailer_exists;case"movies":return e.is_movie&&e.trailer_exists;case"series":return!e.is_movie&&e.trailer_exists;default:return W(r,t,e)}})}function H(i,t,r){i.sort((e,s)=>{let n=e[t],a=s[t];return n instanceof Date&&a instanceof Date?r?n.getTime()-a.getTime():a.getTime()-n.getTime():typeof n=="number"&&typeof a=="number"?r?n-a:a-n:r?e[t].toString().localeCompare(s[t].toString()):s[t].toString().localeCompare(e[t].toString())})}function R(i){return w(T({},i),{added_at:new Date(`${i.added_at}Z`),updated_at:new Date(`${i.updated_at}Z`),downloaded_at:new Date(`${i.downloaded_at}Z`),isImageLoaded:!1})}function N(i){let t=[{type:"folder",name:"None",size:"",path:"",files:[],modified:new Date,isExpanded:!1}];return i.files&&(t=i.files.map(r=>Z(r)?K(r):N(r))),w(T({},i),{isExpanded:!1,modified:new Date(`${i.created}Z`),files:t})}function K(i){return w(T({},i),{isExpanded:!1,modified:new Date(`${i.created}Z`)})}function Z(i){return i.type==="file"}var lt=(()=>{let t=class t{constructor(){this.httpClient=F(M),this.customfilterService=F(O),this.mediaUrl=D.apiUrl+D.media,this.customFilters=this.customfilterService.viewFilters,this.defaultDisplayCount=50,this.checkedMediaIDs=l([]),this.displayCount=l(this.defaultDisplayCount),this.inEditMode=l(!1),this.moviesOnly=l(null),this.selectedMediaID=l(null),this.selectedSort=l("added_at"),this.sortAscending=l(!0),this.selectedFilter=l("all"),this.mediaResource=A(()=>({url:this.mediaUrl+"all"}),{defaultValue:[],parse:e=>e&&Array.isArray(e)?e.map(R):[]}),this.filteredSortedMedia=S(()=>{let e=b(this.allMedia(),this.selectedFilter(),this.customFilters());return H(e,this.selectedSort(),this.sortAscending()),e}),this.displayMedia=S(()=>this.filteredSortedMedia().slice(0,this.displayCount())),this.selectedMedia=S(()=>{let e=this.selectedMediaID();return e===null?null:this.mediaResource.value().find(s=>s.id===e)||null}),this.allMedia=S(()=>{switch(this.moviesOnly()){case!0:return this.mediaResource.value().filter(s=>s.is_movie);case!1:return this.mediaResource.value().filter(s=>!s.is_movie);case null:return this.mediaResource.value().filter(s=>s.status.toLowerCase()==="downloaded")}})}searchMedia(e){let s=`${this.mediaUrl}search`,n=new _().set("query",e);return this.httpClient.get(s,{params:n})}batchUpdate(e,s,n=-1){let a=`${this.mediaUrl}batch_update`;return this.httpClient.post(a,{media_ids:e,action:s.toLowerCase(),profile_id:n})}downloadMediaTrailer(e,s,n){let a=new _().set("profile_id",s).set("yt_id",n),f=`${this.mediaUrl}${e}/download`;return this.httpClient.post(f,{},{params:a})}monitorMedia(e,s){let n=new _().set("monitor",s),a=`${this.mediaUrl}${e}/monitor`;return this.httpClient.post(a,{},{params:n})}deleteMediaTrailer(e){let s=`${this.mediaUrl}${e}/trailer`;return this.httpClient.delete(s)}fetchMediaFiles(e){return $(this,null,function*(){let s=`${this.mediaUrl}${e}/files`,n=yield C(this.httpClient.get(s));return N(n)})}searchMediaTrailer(e,s){let n=new _().set("profile_id",s),a=`${this.mediaUrl}${e}/search`;return this.httpClient.post(a,{},{params:n})}saveMediaTrailer(e,s){let n=`${this.mediaUrl}${e}/update`,a=new _().set("yt_id",s);return this.httpClient.post(n,{},{params:a})}};t.\u0275fac=function(s){return new(s||t)},t.\u0275prov=E({token:t,factory:t.\u0275fac,providedIn:"root"});let i=t;return i})();export{j as a,B as b,J as c,lt as d};
