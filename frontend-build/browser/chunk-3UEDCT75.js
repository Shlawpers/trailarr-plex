import{A as de,b as K,c as f,d as Z,e as Y,j as z,k as J,n as X,o as ee,p as te,q as ie,r as ne,s as oe,t as re,w as le,y as ae,z as se}from"./chunk-PSGRVHCD.js";import{a as ce}from"./chunk-LLDKFHLB.js";import{Bb as p,Gb as G,Gc as W,Hb as q,Jb as d,Jc as T,Lb as N,Na as s,Ua as $,Y as Q,Ya as B,bb as S,ca as v,dc as D,ec as j,hb as h,ka as m,la as _,ma as L,mb as E,ob as F,pb as b,qb as A,rb as o,sb as r,ta as P,tb as c,xa as M,xb as R,yb as C,zb as l}from"./chunk-M4QNQTBX.js";var I=function(t){return t.EQUALS="EQUALS",t}(I||{}),x=function(t){return t.IS_AFTER="IS_AFTER",t.IS_BEFORE="IS_BEFORE",t.IN_THE_LAST="IN_THE_LAST",t.NOT_IN_THE_LAST="NOT_IN_THE_LAST",t.EQUALS="EQUALS",t.NOT_EQUALS="NOT_EQUALS",t}(x||{}),k=function(t){return t.GREATER_THAN="GREATER_THAN",t.GREATER_THAN_EQUAL="GREATER_THAN_EQUAL",t.LESS_THAN="LESS_THAN",t.LESS_THAN_EQUAL="LESS_THAN_EQUAL",t.EQUALS="EQUALS",t.NOT_EQUALS="NOT_EQUALS",t}(k||{}),H=function(t){return t.CONTAINS="CONTAINS",t.NOT_CONTAINS="NOT_CONTAINS",t.EQUALS="EQUALS",t.NOT_EQUALS="NOT_EQUALS",t.STARTS_WITH="STARTS_WITH",t.NOT_STARTS_WITH="NOT_STARTS_WITH",t.ENDS_WITH="ENDS_WITH",t.NOT_ENDS_WITH="NOT_ENDS_WITH",t.IS_EMPTY="IS_EMPTY",t.IS_NOT_EMPTY="IS_NOT_EMPTY",t}(H||{}),y=["arr_monitored","is_movie","media_exists","monitor","trailer_exists"],O=["added_at","downloaded_at","updated_at"],w=["arr_id","connection_id","id","runtime","year"],U=["clean_title","folder_path","imdb_id","language","media_filename","overview","status","studio","title","title_slug","txdb_id","youtube_trailer_id"],u=function(t){return t.HOME="HOME",t.MOVIES="MOVIES",t.SERIES="SERIES",t.TRAILER="TRAILER",t}(u||{});var ue=(()=>{class t{constructor(){this.httpClient=v(W),this.cf_url=T.apiUrl+T.customfilters}create(e){if(e.filter_type===u.TRAILER){let i=T.apiUrl+T.profiles,n={customfilter:e};return this.httpClient.post(i,n)}return this.httpClient.post(this.cf_url,e)}update(e){let i=this.cf_url+e.id;return this.httpClient.put(i,e)}delete(e){let i=this.cf_url+e;return this.httpClient.delete(i)}getViewFilters(e){let i=e==null?"home":e?"movie":"series",n=this.cf_url+i;return this.httpClient.get(n)}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var _e=["customFilterDialog"];function pe(t,a){t&1&&c(0,"app-load-indicator",1)}function fe(t,a){if(t&1&&(o(0,"option",16),d(1),r()),t&2){let e=a.$implicit,i=l(3);h("value",e),s(),N(" ",i.displayTitle(e)," ")}}function ge(t,a){if(t&1&&(o(0,"option",16),d(1),r()),t&2){let e=a.$implicit,i=l(3);h("value",e),s(),N(" ",i.displayTitle(e)," ")}}function Ce(t,a){if(t&1&&c(0,"input",18),t&2){let e=l().$index;p("id","filter_value_",e,"")}}function he(t,a){if(t&1&&c(0,"input",19),t&2){let e=l().$index;p("id","filter_value_",e,"")}}function ve(t,a){if(t&1&&(c(0,"input",25),o(1,"span"),d(2," days"),r()),t&2){let e=l().$index;p("id","filter_value_",e,"")}}function Te(t,a){if(t&1&&c(0,"input",20),t&2){let e=l().$index;p("id","filter_value_",e,"")}}function xe(t,a){if(t&1&&(o(0,"select",21)(1,"option",26),d(2,"True"),r(),o(3,"option",27),d(4,"False"),r()()),t&2){let e=l().$index;p("id","filter_value_",e,"")}}function ye(t,a){if(t&1){let e=R();o(0,"div",8)(1,"div",4)(2,"select",14),C("change",function(n){let g=m(e).$index,V=l(2);return _(V.onFilterByChange(n,g))}),o(3,"option",15),d(4,"Select Filter By"),r(),b(5,fe,2,2,"option",16,F),r()(),o(7,"div",4)(8,"select",17),C("change",function(n){let g=m(e).$index,V=l(2);return _(V.onFilterConditionChange(n,g))}),o(9,"option",15),d(10,"Select Condition"),r(),b(11,ge,2,2,"option",16,F),r()(),o(13,"div",4),S(14,Ce,1,2,"input",18)(15,he,1,2,"input",19)(16,ve,3,2)(17,Te,1,2,"input",20)(18,xe,5,2,"select",21),r(),o(19,"button",22),C("click",function(){let n=m(e).$index,g=l(2);return _(g.removeFilter(n))}),L(),o(20,"svg",23),c(21,"path",24),r()()()}if(t&2){let e=a.$index,i=l(2);h("formGroupName",e),s(2),p("id","filter_by_",e,""),s(3),A(i.filterKeys),s(3),p("id","filter_condition_",e,""),s(3),A(i.filterConditions[e]),s(3),E(i.filterValueTypes[e]==="string"?14:i.filterValueTypes[e]==="number"?15:i.filterValueTypes[e]==="number_days"?16:i.filterValueTypes[e]==="date"?17:i.filterValueTypes[e]==="boolean"?18:-1)}}function Se(t,a){if(t&1&&(o(0,"button",12),d(1),r()),t&2){let e=l(2);h("disabled",e.customFilterForm.pristine||e.customFilterForm.invalid||e.submitting),s(),N(" ",e.customFilter()?"Update":"Create"," ")}}function Ee(t,a){t&1&&(o(0,"div",13),L(),o(1,"svg",28)(2,"circle",29),c(3,"animate",30),r(),o(4,"circle",31),c(5,"animate",32),r(),o(6,"circle",33),c(7,"animate",34),r()()())}function Fe(t,a){if(t&1){let e=R();o(0,"form",3),C("ngSubmit",function(){m(e);let n=l();return _(n.onSubmit())})("click",function(n){return m(e),_(n.stopPropagation())}),o(1,"div",4)(2,"label",5),d(3,"Label"),r(),c(4,"input",6),r(),o(5,"div",7),b(6,ye,22,6,"div",8,F),o(8,"button",9),C("click",function(){m(e);let n=l();return _(n.addFilter())}),d(9,"Add Filter"),r()(),o(10,"div",10)(11,"button",11),C("click",function(){m(e);let n=l();return _(n.closeDialog(-1))}),d(12,"Cancel"),r(),S(13,Se,2,2,"button",12)(14,Ee,8,0,"div",13),r()()}if(t&2){let e=l();h("formGroup",e.customFilterForm),s(6),A(e.filters.controls),s(7),E(e.submitting?14:13)}}var Pe=(()=>{class t{constructor(){this.fb=v(ae),this.filterType=M.required(),this.filterTypeValue=D(()=>{let e=this.filterType().toUpperCase();return e=="MOVIES"?u.MOVIES:e=="SERIES"?u.SERIES:e=="TRAILER"?u.TRAILER:u.HOME}),this.customFilter=M(null),this.dialogClosed=new P,this.isLoading=!0,this.customfilterService=v(ue),this.computedSignal=D(()=>{let e=this.customFilter();return this.initForm(e),!0}),this.boolFilterConditions=Object.values(I),this.dateFilterConditions=Object.values(x),this.numberFilterConditions=Object.values(k),this.stringFilterConditions=Object.values(H),this.filterConditions=[],this.filterValueTypes=[],this.filterKeys=y.concat(O,w,U).sort(),this.viewForOptions=Object.values(u),this.customFilterDialog=$.required("customFilterDialog"),this.submitting=!1,j(()=>{this.initForm(this.customFilter())})}ngAfterViewInit(){this.customFilterDialog().nativeElement.showModal()}closeDialog(e){this.customFilterDialog().nativeElement.close(),this.dialogClosed.emit(e),this.filters.clear(),this.addFilter(),this.customFilterForm.reset()}displayTitle(e){return e.toLowerCase().replace(/_/g," ").replace(/\b\w/g,i=>i.toUpperCase())}initForm(e){let i=this.fb.group({id:[e?e.id:null],filter_type:[e?e.filter_type:this.filterTypeValue(),f.required],filter_name:[e?e.filter_name:"",[f.required,f.maxLength(30)]],filters:this.fb.array([],f.required)});return this.customFilterForm=i,e&&e.filters&&e.filters.length?e.filters.forEach(n=>{this.addFilter(n)}):this.addFilter(),this.isLoading=!1,i}get filters(){return this.customFilterForm.get("filters")}createFilter(e){return this.fb.group({id:[e?e.id:null],filter_by:[e?e.filter_by:"",f.required],filter_condition:[e?e.filter_condition:"",f.required],filter_value:[e?e.filter_value:"",f.required],customfilter_id:[e?e.customfilter_id:null]})}getFilterConditions(e){return y.includes(e)?this.boolFilterConditions:O.includes(e)?this.dateFilterConditions:w.includes(e)?this.numberFilterConditions:U.includes(e)?this.stringFilterConditions:[]}getFilterValueType(e,i){return y.includes(e)?"boolean":O.includes(e)?i===x.IN_THE_LAST||i===x.NOT_IN_THE_LAST?"number_days":"date":w.includes(e)?"number":"string"}addFilter(e){e&&e.filter_by?(this.filterConditions.push(this.getFilterConditions(e.filter_by)),this.filterValueTypes.push(this.getFilterValueType(e.filter_by,e.filter_condition))):(this.filterConditions.push([]),this.filterValueTypes.push("string")),this.filters.push(this.createFilter(e))}removeFilter(e){this.filterConditions.splice(e,1),this.filters.removeAt(e)}onFilterByChange(e,i){let n=this.filters.at(i).get("filter_by")?.value;this.filterConditions[i]=this.getFilterConditions(n),this.filterValueTypes[i]=this.getFilterValueType(n,""),this.filters.at(i).get("filter_condition")?.setValue(""),y.includes(n)&&this.filters.at(i).get("filter_condition")?.setValue(I.EQUALS),this.filters.at(i).get("filter_value")?.reset()}onFilterConditionChange(e,i){let n=this.filters.at(i).get("filter_by")?.value;if(e.target){let g=e.target.value;this.filterValueTypes[i]=this.getFilterValueType(n,g)}this.filters.at(i).get("filter_value")?.reset()}onSubmit(){if(!this.submitting)if(this.submitting=!0,this.customFilterForm.valid){let e=this.customFilterForm.value;e.filters.forEach(i=>{i.filter_value=i.filter_value.toString()}),this.customFilter()?.id?this.customfilterService.update(e).subscribe(i=>{this.closeDialog(i.id),this.submitting=!1}):this.customfilterService.create(e).subscribe(i=>{this.closeDialog(i.id),this.submitting=!1})}else console.log("Form is invalid"),this.customFilterForm.markAllAsTouched(),this.submitting=!1}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=B({type:t,selectors:[["app-add-filter-dialog"]],viewQuery:function(i,n){i&1&&G(n.customFilterDialog,_e,5),i&2&&q()},inputs:{filterType:[1,"filterType"],customFilter:[1,"customFilter"]},outputs:{dialogClosed:"dialogClosed"},decls:4,vars:1,consts:[["customFilterDialog",""],[1,"center"],[3,"formGroup"],[3,"ngSubmit","click","formGroup"],[1,"form-group"],["for","filter_name"],["id","filter_name","type","text","maxlength","30","formControlName","filter_name"],["formArrayName","filters",1,"filters-container"],[1,"filter-group",3,"formGroupName"],["type","button",1,"secondary",3,"click"],[1,"buttons-row"],["type","button",1,"danger",3,"click"],["type","submit",1,"primary",3,"disabled"],["title","Submitting form data"],["formControlName","filter_by",3,"change","id"],["value","","disabled",""],[3,"value"],["formControlName","filter_condition",3,"change","id"],["type","text","formControlName","filter_value",3,"id"],["type","number","formControlName","filter_value",3,"id"],["type","date","formControlName","filter_value",3,"id"],["formControlName","filter_value",3,"id"],["type","button",1,"danger","icononly-button",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 -960 960 960"],["d","M253-99q-38.21 0-65.11-26.6Q161-152.2 161-190v-552h-58v-91h228v-47h297v47h228v91h-58v552q0 37.18-27.21 64.09Q743.59-99 706-99H253Zm453-643H253v552h453v-552ZM357-268h74v-398h-74v398Zm173 0h75v-398h-75v398ZM253-742v552-552Z"],["type","number","placeholder","days","formControlName","filter_value",3,"id"],["value","true"],["value","false"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 200 200",1,"icon-loading"],["stroke-width","14","r","15","cx","40","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.4"],["stroke-width","14","r","15","cx","100","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","-.2"],["stroke-width","14","r","15","cx","160","cy","65"],["attributeName","cy","calcMode","spline","dur","2","values","65;135;65;","keySplines",".5 0 .5 1;.5 0 .5 1","repeatCount","indefinite","begin","0"]],template:function(i,n){i&1&&(o(0,"dialog",null,0),S(2,pe,1,0,"app-load-indicator",1)(3,Fe,15,2,"form",2),r()),i&2&&(s(2),E(n.isLoading?2:3))},dependencies:[se,z,oe,re,K,J,ne,Z,Y,le,ce,de,X,ie,ee,te],styles:["[_nghost-%COMP%]{display:contents}.center[_ngcontent-%COMP%]{margin:auto}form[_ngcontent-%COMP%]{padding:1rem;display:block flex;flex-direction:column;gap:1rem}label[_ngcontent-%COMP%]{display:block;margin-bottom:.4rem;font-weight:700}input[_ngcontent-%COMP%], select[_ngcontent-%COMP%]{padding:.5rem;box-sizing:border-box}option[_ngcontent-%COMP%]{background-color:var(--color-surface-container-high)}.ng-touched.ng-invalid[_ngcontent-%COMP%]:not(form):not(div){border:2px solid var(--color-danger)}.error[_ngcontent-%COMP%]{color:var(--color-danger);font-size:.9rem;margin-top:.4rem}.filters-container[_ngcontent-%COMP%]{border-top:1px solid var(--color-outline);padding-top:1rem}.filter-group[_ngcontent-%COMP%]{display:block flex;flex-wrap:wrap;gap:1rem;align-items:center;border:1px solid var(--color-outline);border-radius:.5rem;padding:.5rem;margin-bottom:.75rem;background-color:var(--color-surface-container-high)}.filter-group[_ngcontent-%COMP%]   [_ngcontent-%COMP%]:nth-child(3){flex:1;text-align:start}.danger[_ngcontent-%COMP%]{width:auto;height:auto}.danger[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{fill:var(--color-danger-text)}.buttons-row[_ngcontent-%COMP%]{display:block flex;align-items:center;justify-content:space-around}.icon-loading[_ngcontent-%COMP%]{width:1.5rem;height:1.5rem;fill:var(--color-on-surface)}"]})}}return t})();export{x as a,k as b,H as c,y as d,O as e,w as f,U as g,ue as h,Pe as i};
